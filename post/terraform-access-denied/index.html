<!DOCTYPE html>
<html lang="en-us" data-theme="light">
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>terraform-access-denied-access-denied | Karthikeyan Sundararajan</title>

<link rel="stylesheet" href="https://karthikeayan.github.io//css/styles.css">

<link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.2.0/css/all.css" 
integrity="sha384-hWVjflwFxL6sNzntih27bfxkr27PmbbK/iSvJ+a4+0owXq79v+lsFkW54bOGbiDQ" crossorigin="anonymous">
<script src="https://code.jquery.com/jquery-3.3.1.js" integrity="sha256-2Kok7MbOyxpgUVvAk/HJ2jigOSYS2auK4Pfzbm7uH60=" crossorigin="anonymous"></script>


<div class="container">
    <nav class="navbar level">
      <div class="navbar-brand">
          <a class="nav-item" href="https://karthikeayan.github.io/"><h1 class="title is-3">Karthikeyan Sundararajan</h1></a>
      </div>           
      <div class="navbar-menu has-text-centered is-active">
          <div class="navbar-end is-centered">
              
                <a href="https://karthikeayan.github.io/about.html" rel="me">
                  <span class="icon">
                    <i class="fas fa-info"></i>
                  </span>
                </a>
              
                <a href="https://github.com/karthikeayan" rel="me">
                  <span class="icon">
                    <i class="fab fa-github"></i>
                  </span>
                </a>
              
                <a href="https://www.linkedin.com/in/karthikeyan-sundararajan/" rel="me">
                  <span class="icon">
                    <i class="fab fa-linkedin-in"></i>
                  </span>
                </a>
              
                <a href="https://twitter.com/karthikeayan" rel="me">
                  <span class="icon">
                    <i class="fab fa-twitter"></i>
                  </span>
                </a>
              
           </div>
      </div>
    </nav>
  </div>

<div class="container">
  <h2 class="subtitle is-6">January 21, 2021</h2>
  <h1 class="subtitle is-size-4-mobile is-size-3-desktop">terraform-access-denied-access-denied</h1>
  <div class="content">
    <h1 id="terraform-access-denied-access-denied">Terraform Access Denied Access Denied</h1>
<p>You are working with Terraform, AWS and S3 for Remote State and suddenly you see a message</p>
<div class="highlight"><pre tabindex="0" style="color:#c9c9c9;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>AccessDenied: Access Denied
</span></span></code></pre></div><p>Terraform doesn&rsquo;t give you lots of information, you are checking your IAM access, checking your Terraform provider and scratching your head what is going on.</p>
<p>This is what I did.</p>
<ul>
<li>I ran &ldquo;terraform apply&rdquo; with provider pointing to Account A.</li>
<li>Terraform created few resources in AWS and its corresponding state in S3 bucket.</li>
<li>I found, I ran &ldquo;terraform apply&rdquo; with the wrong provider.</li>
<li>I corrected the typo in the provider to point to Account B and I ran &ldquo;terraform apply&rdquo; again.</li>
<li>Now, I am running &ldquo;terraform apply&rdquo; with provider pointing to Account B.</li>
</ul>
<p>This is what happened.</p>
<div class="highlight"><pre tabindex="0" style="color:#c9c9c9;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>AccessDenied: Access Denied
</span></span></code></pre></div><p>This is why it happened.
Terraform looks for the remote state file in the S3 bucket and the provider is pointing to Account A. But in my code provider is pointing to Account B.</p>
<p>This is how it can be fixed.</p>
<ul>
<li>Point the provider to Account A.</li>
<li>Run &ldquo;terraform destroy&rdquo; to completely destory everything which got created in Account A.</li>
<li>Now point provider to Account B.</li>
<li>Run &ldquo;terraform apply&rdquo;</li>
<li>Go to sleep</li>
</ul>

  </div>
</div>
<div class="container has-text-centered">
    
</div>

<div class="container has-text-centered">
  
</div>

<section class="section py-0">
  <div class="container has-text-centered">
    <p></p>
  </div>
</section>

