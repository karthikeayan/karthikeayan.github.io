<!DOCTYPE html>
<html lang="en-us" data-theme="light">
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>ecs-shell | Karthikeyan Sundararajan</title>

<link rel="stylesheet" href="https://karthikeayan.github.io//css/styles.css">

<link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.2.0/css/all.css" 
integrity="sha384-hWVjflwFxL6sNzntih27bfxkr27PmbbK/iSvJ+a4+0owXq79v+lsFkW54bOGbiDQ" crossorigin="anonymous">
<script src="https://code.jquery.com/jquery-3.3.1.js" integrity="sha256-2Kok7MbOyxpgUVvAk/HJ2jigOSYS2auK4Pfzbm7uH60=" crossorigin="anonymous"></script>


<div class="container">
    <nav class="navbar level">
      <div class="navbar-brand">
          <a class="nav-item" href="https://karthikeayan.github.io/"><h1 class="title is-3">Karthikeyan Sundararajan</h1></a>
      </div>           
      <div class="navbar-menu has-text-centered is-active">
          <div class="navbar-end is-centered">
              
                <a href="https://karthikeayan.github.io/about.html" rel="me">
                  <span class="icon">
                    <i class="fas fa-info"></i>
                  </span>
                </a>
              
                <a href="https://github.com/karthikeayan" rel="me">
                  <span class="icon">
                    <i class="fab fa-github"></i>
                  </span>
                </a>
              
                <a href="https://www.linkedin.com/in/karthikeyan-sundararajan/" rel="me">
                  <span class="icon">
                    <i class="fab fa-linkedin-in"></i>
                  </span>
                </a>
              
                <a href="https://twitter.com/karthikeayan" rel="me">
                  <span class="icon">
                    <i class="fab fa-twitter"></i>
                  </span>
                </a>
              
           </div>
      </div>
    </nav>
  </div>

<div class="container">
  <h2 class="subtitle is-6">December 12, 2021</h2>
  <h1 class="subtitle is-size-4-mobile is-size-3-desktop">ecs-shell</h1>
  <div class="content">
    <h1 id="get-shell-of-a-container-running-on-ecs">Get shell of a container running on ECS</h1>
<p>ECS is a managed container orchestration service by AWS. Known for its simplicity, especially ECS Fargate.</p>
<p>Since ECS Fargate nodes are completely managed by AWS, there is no way to SSH into the node.</p>
<p>Also ECS was lacking a command line option just like,</p>
<div class="highlight"><pre tabindex="0" style="color:#c9c9c9;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>kubectl exec
</span></span></code></pre></div><p>On March 2021, AWS launched a feature which is similar to &ldquo;kubectl exec&rdquo; to obtain a shell access of a container running on ECS Fargate.</p>
<p><a href="https://aws.amazon.com/blogs/containers/new-using-amazon-ecs-exec-access-your-containers-fargate-ec2/">https://aws.amazon.com/blogs/containers/new-using-amazon-ecs-exec-access-your-containers-fargate-ec2/</a></p>
<p>This helped me a lot to troubleshoot issues.</p>
<p>Since I have to login into lots of different containers running on different ECS Clusters which in turn running on different AWS Accounts, it became difficult to copy paste and edit the command everytime.</p>
<p>So, I just wrote a very simple shell script which can help me. Here is the script.</p>
<div class="highlight"><pre tabindex="0" style="color:#c9c9c9;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#7fbaf5">#!/usr/local/bin/bash
</span></span></span><span style="display:flex;"><span><span style="color:#7fbaf5"></span>
</span></span><span style="display:flex;"><span><span style="color:#7fbaf5">echo</span> Enter Cluster Name:
</span></span><span style="display:flex;"><span><span style="color:#7fbaf5">read</span> -e cluster_name
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#7fbaf5">echo</span> Enter Container Name:
</span></span><span style="display:flex;"><span><span style="color:#7fbaf5">read</span> -e container_name
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#7fbaf5">echo</span> Enter Service Name:
</span></span><span style="display:flex;"><span><span style="color:#7fbaf5">read</span> -e service_name
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#7fbaf5">echo</span> Enter AWS Profile Name:
</span></span><span style="display:flex;"><span><span style="color:#7fbaf5">read</span> -e profile
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#bc74c4;font-style:italic">region</span><span style="color:#bc74c4">=</span><span style="color:#82cc6a">&#34;eu-west-1&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#bc74c4;font-style:italic">task_ids</span><span style="color:#bc74c4">=(</span><span style="color:#7fbaf5">$(</span>aws ecs list-tasks --cluster <span style="color:#82cc6a">${</span><span style="color:#bc74c4;font-style:italic">cluster_name</span><span style="color:#82cc6a">}</span> --service-name <span style="color:#82cc6a">${</span><span style="color:#bc74c4;font-style:italic">service_name</span><span style="color:#82cc6a">}</span> --profile <span style="color:#82cc6a">${</span><span style="color:#bc74c4;font-style:italic">profile</span><span style="color:#82cc6a">}</span> --region <span style="color:#82cc6a">${</span><span style="color:#bc74c4;font-style:italic">region</span><span style="color:#82cc6a">}</span> <span style="color:#56b6c2">|</span> jq <span style="color:#82cc6a">&#39;.taskArns[]&#39;</span> -r <span style="color:#56b6c2">|</span> cut -d<span style="color:#82cc6a">&#39;/&#39;</span> -f3<span style="color:#7fbaf5">)</span><span style="color:#bc74c4">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#bc74c4;font-style:italic">counter</span><span style="color:#bc74c4">=</span><span style="color:#56b6c2">1</span>
</span></span><span style="display:flex;"><span><span style="color:#7fbaf5">declare</span> -A tasks
</span></span><span style="display:flex;"><span><span style="color:#7fbaf5">for</span> i in <span style="color:#82cc6a">&#34;</span><span style="color:#82cc6a">${</span><span style="color:#bc74c4;font-style:italic">task_ids</span><span style="color:#56b6c2">[@]</span><span style="color:#82cc6a">}</span><span style="color:#82cc6a">&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#7fbaf5">do</span>
</span></span><span style="display:flex;"><span>  <span style="color:#7fbaf5">echo</span> <span style="color:#82cc6a">&#34;</span><span style="color:#82cc6a">${</span><span style="color:#bc74c4;font-style:italic">counter</span><span style="color:#82cc6a">}</span><span style="color:#82cc6a">: </span><span style="color:#82cc6a">${</span><span style="color:#bc74c4;font-style:italic">i</span><span style="color:#82cc6a">}</span><span style="color:#82cc6a">&#34;</span>
</span></span><span style="display:flex;"><span>  tasks<span style="color:#bc74c4">[</span><span style="color:#82cc6a">&#34;</span><span style="color:#82cc6a">${</span><span style="color:#bc74c4;font-style:italic">counter</span><span style="color:#82cc6a">}</span><span style="color:#82cc6a">&#34;</span><span style="color:#bc74c4">]=</span><span style="color:#82cc6a">&#34;</span><span style="color:#82cc6a">${</span><span style="color:#bc74c4;font-style:italic">i</span><span style="color:#82cc6a">}</span><span style="color:#82cc6a">&#34;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#bc74c4;font-style:italic">counter</span><span style="color:#bc74c4">=</span><span style="color:#7fbaf5">$((</span>counter+1<span style="color:#7fbaf5">))</span>
</span></span><span style="display:flex;"><span><span style="color:#7fbaf5">done</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#7fbaf5">echo</span> Enter Task Number:
</span></span><span style="display:flex;"><span><span style="color:#7fbaf5">read</span> task_counter
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>aws ecs execute-command --cluster <span style="color:#82cc6a">${</span><span style="color:#bc74c4;font-style:italic">cluster_name</span><span style="color:#82cc6a">}</span> --task <span style="color:#82cc6a">${</span><span style="color:#bc74c4;font-style:italic">tasks</span><span style="color:#56b6c2">[</span><span style="color:#82cc6a">&#34;</span><span style="color:#82cc6a">${</span><span style="color:#bc74c4;font-style:italic">task_counter</span><span style="color:#82cc6a">}</span><span style="color:#82cc6a">&#34;</span><span style="color:#56b6c2">]</span><span style="color:#82cc6a">}</span> --container <span style="color:#82cc6a">${</span><span style="color:#bc74c4;font-style:italic">container_name</span><span style="color:#82cc6a">}</span> --interactive --command <span style="color:#82cc6a">&#34;/bin/sh&#34;</span> --profile <span style="color:#82cc6a">${</span><span style="color:#bc74c4;font-style:italic">profile</span><span style="color:#82cc6a">}</span> --region <span style="color:#82cc6a">${</span><span style="color:#bc74c4;font-style:italic">region</span><span style="color:#82cc6a">}</span>
</span></span></code></pre></div>
  </div>
</div>
<div class="container has-text-centered">
    
</div>

<div class="container has-text-centered">
  
</div>

<section class="section py-0">
  <div class="container has-text-centered">
    <p></p>
  </div>
</section>

